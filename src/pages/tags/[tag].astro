---
import PostCard from "@components/PostCard.astro";
import BaseLayout from "@layouts/BaseLayout.astro";
import { getShowablePosts, getUniqueTags, sortPosts } from "@util/BlogHelper";
import { capitalizeFirstLetter } from "@util/StringHelpers";
import { type CollectionEntry, getCollection } from "astro:content";

export type Props = {
  posts: CollectionEntry<"blog">[];
  tag: string;
};

export async function getStaticPaths() {
  const allPosts = await getCollection("blog", getShowablePosts);
  const uniqueTags = getUniqueTags(allPosts);

  return uniqueTags.map((tag) => ({
    params: { tag },
    props: {
      tag,
      posts: allPosts.filter((post) => post.data.tags.includes(tag)),
    },
  }));
}

const { posts, tag } = Astro.props;
const titleString = `${capitalizeFirstLetter(tag)} Tagged Posts | SamTheQ`;
---

<BaseLayout title={titleString} description={`All blog posts with the ${tag} tag`}>
  <main class="bs-container-md mt-16 max-w-[52rem] grow scroll-mt-16 px-4 pb-28">
    <!-- sm:px-6 md:px-8 lg:max-w-6xl xl:px-12 -->
    <section data-post-heading class="pt-5">
      <h1 class="m-0 text-5xl font-extrabold">
        Welcome to <span class="text-gradient">Astro</span>
      </h1>
      <p class="instructions">
        To get started, open the directory <code>src/pages</code> in your project.<br />
        <strong>Code Challenge:</strong> Tweak the "Welcome to Astro" message above.
      </p>
    </section>
    <ul data-post-count={posts.length} class="mt-8 space-y-16">
      {posts.sort(sortPosts).map((post) => <PostCard {...post.data} slug={post.slug} />)}
    </ul>
  </main>
</BaseLayout>
